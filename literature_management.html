<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文献管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* (Similar styles as results_management.html for consistency) */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a1a1a1; }
        .table-fixed-layout { table-layout: fixed; }
        .action-menu { position: absolute; right: 0; top: 100%; margin-top: 0.25rem; z-index: 20; }
        .status-badge { padding: 0.25rem 0.6rem; font-size: 0.75rem; border-radius: 9999px; font-weight: 500; }
        .status-unprocessed { background-color: #f3f4f6; color: #4b5563; } /* gray-100, gray-600 */
        .status-processing { background-color: #fef3c7; color: #b45309; } /* amber-100, amber-700 */
        .status-analyzed { background-color: #d1fae5; color: #047857; } /* green-100, green-700 */
        .status-error { background-color: #fee2e2; color: #b91c1c; } /* red-100, red-700 */
    </style>
</head>
<body class="bg-slate-100 font-sans p-4 md:p-6">
    <div class="container mx-auto">
        <header class="mb-6 flex justify-between items-center">
            <h1 class="text-2xl font-semibold text-slate-800">文献管理</h1>
            <button id="upload-literature-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg flex items-center text-sm shadow-md">
                <i class="fas fa-upload mr-2"></i> 上传文献
            </button>
        </header>

        <div class="bg-white p-4 sm:p-6 rounded-lg shadow mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                <div>
                    <label for="search-literature" class="block text-sm font-medium text-slate-700 mb-1">搜索文献</label>
                    <div class="relative">
                        <input type="text" id="search-literature" placeholder="按标题、来源搜索..." class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-sm">
                        <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
                    </div>
                </div>
                <div>
                    <label for="tag-filter-lit" class="block text-sm font-medium text-slate-700 mb-1">标签筛选</label>
                    <select id="tag-filter-lit" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-sm bg-white">
                        <option value="">所有标签</option>
                        <option value="IBD">IBD</option>
                        <option value="药材">药材</option>
                        <option value="临床研究">临床研究</option>
                    </select>
                </div>
                 <div>
                    <label for="status-filter-lit" class="block text-sm font-medium text-slate-700 mb-1">状态筛选</label>
                    <select id="status-filter-lit" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-sm bg-white">
                        <option value="">所有状态</option>
                        <option value="unprocessed">未处理</option>
                        <option value="processing">处理中</option>
                        <option value="analyzed">已分析</option>
                        <option value="error">错误</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow overflow-x-auto custom-scrollbar">
            <table class="w-full min-w-[1000px] text-sm text-left text-slate-500 table-fixed-layout">
                <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                    <tr>
                        <th scope="col" class="p-3 w-12"><input type="checkbox" id="select-all-literature" class="form-checkbox h-4 w-4 text-blue-600"></th>
                        <th scope="col" class="p-3 w-1/6">标题</th>
                        <th scope="col" class="p-3 w-1/6">来源</th>
                        <th scope="col" class="p-3 w-1/6">上传日期</th>
                        <th scope="col" class="p-3 w-1/6">标签</th>
                        <th scope="col" class="p-3 w-24">状态</th>
                        <th scope="col" class="p-3 w-28 text-center">操作</th>
                    </tr>
                </thead>
                <tbody id="literature-table-body">
                    <!-- Rows populated by JS -->
                </tbody>
            </table>
        </div>
        
        <div id="lit-pagination-controls" class="mt-6 flex justify-center items-center space-x-1">
            <!-- Pagination populated by JS -->
        </div>
    </div>

    <script>
        const mockLiteratureData = [
            { id: "lit001", title: "IBD最新研究进展.pdf", source: "PubMed", uploadDate: "2024-03-10", tags: ["IBD", "综述"], status: "analyzed", originalDocUrl: "sample_doc1.pdf" },
            { id: "lit002", title: "白芍化学成分分析.docx", source: "CNKI", uploadDate: "2024-03-12", tags: ["药材", "白芍", "化学"], status: "processing", originalDocUrl: "sample_doc2.pdf" },
            { id: "lit003", title: "炎症性肠病治疗靶点研究.pdf", source: "Elsevier", uploadDate: "2024-02-20", tags: ["IBD", "药靶"], status: "unprocessed", originalDocUrl: "sample_doc3.pdf" },
            { id: "lit004", title: "北豆根药理作用探讨.pdf", source: "Springer", uploadDate: "2024-01-15", tags: ["药材", "北豆根"], status: "analyzed", originalDocUrl: "sample_doc4.pdf" },
            { id: "lit005", title: "巴豆临床应用安全性评估.pdf", source: "Local Upload", uploadDate: "2023-12-01", tags: ["药材", "巴豆", "临床"], status: "error", originalDocUrl: "sample_doc5.pdf" },
        ];

        const literatureTableBody = document.getElementById('literature-table-body');
        const litPaginationControls = document.getElementById('lit-pagination-controls');
        const itemsPerPageLit = 10;
        let currentPageLit = 1;
        // Add filter state variables if needed

        function getLitStatusBadge(status) {
            switch (status) {
                case 'unprocessed': return '<span class="status-badge status-unprocessed">未处理</span>';
                case 'processing': return '<span class="status-badge status-processing">处理中</span>';
                case 'analyzed': return '<span class="status-badge status-analyzed">已分析</span>';
                case 'error': return '<span class="status-badge status-error">错误</span>';
                default: return `<span class="status-badge">${status}</span>`;
            }
        }

        function openLiteratureResearch(literatureId, literatureTitle) {
            if (window.parent && window.parent.openTab) {
                window.parent.openTab(`文献: ${literatureTitle.substring(0,20)}...`, `literature_research.html?id=${encodeURIComponent(literatureId)}`);
            } else {
                window.location.href = `literature_research.html?id=${encodeURIComponent(literatureId)}`;
            }
        }

        function renderLitTable() {
            literatureTableBody.innerHTML = '';
            // Implement filtering and search later if needed, for now, just pagination
            const paginatedData = mockLiteratureData.slice((currentPageLit - 1) * itemsPerPageLit, currentPageLit * itemsPerPageLit);

            if (paginatedData.length === 0) {
                literatureTableBody.innerHTML = `<tr><td colspan="7" class="text-center p-4 text-slate-500">没有文献记录。</td></tr>`;
                renderLitPagination(0);
                return;
            }

            paginatedData.forEach(item => {
                const row = `
                    <tr class="bg-white border-b hover:bg-slate-50">
                        <td class="p-3"><input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600"></td>
                        <td class="p-3 font-medium text-slate-900 hover:text-blue-600 cursor-pointer truncate" title="${item.title}" onclick="openLiteratureResearch('${item.id}', '${item.title.replace(/'/g, "\\'")}')">${item.title}</td>
                        <td class="p-3 text-slate-600 truncate" title="${item.source}">${item.source}</td>
                        <td class="p-3 text-slate-600">${item.uploadDate}</td>
                        <td class="p-3 text-slate-600 truncate">${item.tags.join(', ')}</td>
                        <td class="p-3">${getLitStatusBadge(item.status)}</td>
                        <td class="p-3 text-center relative">
                            <button class="text-blue-600 hover:text-blue-800 lit-action-toggle"><i class="fas fa-ellipsis-v"></i></button>
                            <div class="action-menu hidden bg-white border border-slate-200 rounded-md shadow-lg py-1 w-28">
                                <a href="#" onclick="openLiteratureResearch('${item.id}', '${item.title.replace(/'/g, "\\'")}')" class="block px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-100">开始调研</a>
                                <a href="#" class="block px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-100">下载原文</a>
                                <a href="#" class="block px-3 py-1.5 text-xs text-red-600 hover:bg-red-50">删除</a>
                            </div>
                        </td>
                    </tr>
                `;
                literatureTableBody.innerHTML += row;
            });
            renderLitPagination(mockLiteratureData.length);
            attachLitActionMenuListeners();
        }

        function renderLitPagination(totalItems) {
            // ... (Similar to results_management.html pagination)
            litPaginationControls.innerHTML = '';
            const totalPages = Math.ceil(totalItems / itemsPerPageLit);
            if (totalPages <= 1) return;

            litPaginationControls.innerHTML += `<button data-page="${currentPageLit - 1}" class="px-3 py-1 text-sm rounded-md ${currentPageLit === 1 ? 'bg-slate-200 text-slate-400 cursor-not-allowed' : 'bg-slate-100 hover:bg-slate-200 text-slate-600'}" ${currentPageLit === 1 ? 'disabled' : ''}>&lt; Previous</button>`;
            for (let i = 1; i <= totalPages; i++) {
                litPaginationControls.innerHTML += `<button data-page="${i}" class="px-3 py-1 text-sm rounded-md ${i === currentPageLit ? 'bg-blue-500 text-white' : 'bg-slate-100 hover:bg-slate-200 text-slate-600'}">${i}</button>`;
            }
            litPaginationControls.innerHTML += `<button data-page="${currentPageLit + 1}" class="px-3 py-1 text-sm rounded-md ${currentPageLit === totalPages ? 'bg-slate-200 text-slate-400 cursor-not-allowed' : 'bg-slate-100 hover:bg-slate-200 text-slate-600'}" ${currentPageLit === totalPages ? 'disabled' : ''}>Next &gt;</button>`;
            
            document.querySelectorAll('#lit-pagination-controls button[data-page]').forEach(button => {
                button.addEventListener('click', (e) => {
                    currentPageLit = parseInt(e.currentTarget.dataset.page);
                    renderLitTable();
                });
            });
        }
         function attachLitActionMenuListeners() {
            document.querySelectorAll('.lit-action-toggle').forEach(toggle => {
                toggle.addEventListener('click', function(event) {
                    event.stopPropagation();
                    document.querySelectorAll('.action-menu').forEach(m => {
                        if (m !== this.nextElementSibling) m.classList.add('hidden');
                    });
                    this.nextElementSibling.classList.toggle('hidden');
                });
            });
        }
        document.addEventListener('click', (event) => {
            if (!event.target.closest('.lit-action-toggle') && !event.target.closest('.action-menu')) {
                document.querySelectorAll('.action-menu').forEach(menu => menu.classList.add('hidden'));
            }
        });


        // Initial Render
        renderLitTable();
    </script>
</body>
</html>