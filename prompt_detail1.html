<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>提示词详情</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a1a1a1; }
        .version-item.active { background-color: #e0f2fe; /* sky-100 */ border-left-color: #0ea5e9; /* sky-500 */ }
        .content-display { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body class="bg-slate-100 font-sans">
    <div class="container mx-auto p-4 md:p-6">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between md:items-center mb-6">
            <div>
                <h1 id="prompt-title" class="text-2xl font-semibold text-slate-800 mb-2">加载中...</h1>
                <p id="prompt-version" class="text-sm text-slate-500">版本: --</p>
            </div>
            <div class="flex items-center space-x-3">
                <button id="copy-btn" class="bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium py-2 px-4 rounded-lg flex items-center text-sm">
                    <i class="fas fa-copy mr-2"></i> 复制内容
                </button>
                <button id="edit-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg flex items-center text-sm">
                    <i class="fas fa-pencil-alt mr-2"></i> 编辑提示词
                </button>
            </div>
        </div>

        <!-- Content -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-lg font-semibold text-slate-700 mb-4">提示词内容</h2>
            <pre id="prompt-content" class="whitespace-pre-wrap text-sm text-slate-600 bg-slate-50 p-4 rounded-lg">加载中...</pre>
        </div>

        <!-- Description -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-lg font-semibold text-slate-700 mb-4">描述</h2>
            <p id="prompt-description" class="text-sm text-slate-600">加载中...</p>
        </div>

        <!-- Tags -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-lg font-semibold text-slate-700 mb-4">标签</h2>
            <div id="prompt-tags" class="flex flex-wrap gap-2">
                <!-- Tags will be inserted here -->
            </div>
        </div>

        <!-- Version History -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-lg font-semibold text-slate-700 mb-4">历史版本</h2>
            <div id="version-history" class="space-y-4">
                <!-- Version history will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // 从 URL 获取提示词 ID 和标题
        const urlParams = new URLSearchParams(window.location.search);
        const promptId = urlParams.get('id');
        const promptTitle = urlParams.get('title');

        // 更新页面标题
        document.getElementById('prompt-title').textContent = promptTitle || '未知提示词';

        // 如果在 iframe 中，尝试从父窗口获取提示词数据
        if (window.parent && window.parent.mockPrompts && promptId) {
            const promptData = window.parent.mockPrompts[promptId];
            if (promptData) {
                // 更新页面内容
                document.getElementById('prompt-version').textContent = `版本: ${promptData.version}`;
                document.getElementById('prompt-content').textContent = promptData.content;
                document.getElementById('prompt-description').textContent = promptData.description;

                // 更新标签
                const tagsContainer = document.getElementById('prompt-tags');
                tagsContainer.innerHTML = promptData.tags.map(tag => `
                    <span class="bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded-full font-medium">${tag}</span>
                `).join('');

                // 如果是系统提示词，禁用编辑按钮
                if (promptData.type === 'system') {
                    const editBtn = document.getElementById('edit-btn');
                    editBtn.disabled = true;
                    editBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    editBtn.classList.remove('hover:bg-blue-600');
                }
            }
        }

        // 复制按钮功能
        document.getElementById('copy-btn').addEventListener('click', () => {
            const content = document.getElementById('prompt-content').textContent;
            navigator.clipboard.writeText(content)
                .then(() => alert('提示词内容已复制到剪贴板！'))
                .catch(err => console.error('复制失败:', err));
        });

        // 编辑按钮功能
        document.getElementById('edit-btn').addEventListener('click', () => {
            if (window.parent && promptId) {
                // 调用父窗口的编辑函数
                window.parent.showAddEditModal?.(true, promptId, promptTitle);
            }
        });
    </script>
</body>
</html>